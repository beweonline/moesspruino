function colors(){window.colors={},colors.current='Servo1',colors[colors.current]=document.getElementById(colors.current).style.fill}function idArrays(){window.servos=['Servo1','Servo2','Servo3','Servo4','Servo1Text','Servo2Text','Servo3Text','Servo4Text'],window.servoText=['tspan1019','tspan1023','tspan1027','tspan1031'],window.servoBars=['Servo1b','Servo2b','Servo3b','Servo4b'],window.pluses=['plusTop','plusBottom','plusTopSymbol','plusBottomSymbol'],window.minuses=['minusTop','minusBottom','minusTopSymbol','minusBottomSymbol'],window.bars=['positionBar','incrementBar'],window.sliderPosition=['positionText','positionSlider',document.getElementById('positionText').children[0].id],window.sliderIncrement=['incrementText','incrementSlider',document.getElementById('incrementText').children[0].id],window.resets=['positionReset','incrementReset','positionResetText','incrementResetText'],window.playStop=['Play','Stop','stripRight'],window.buttons=servos.concat(pluses,minuses,resets),window.colorSwap=bars.concat(['positionReset','incrementReset'],['plusTop','plusBottom'],['minusTop','minusBottom'])}function clearGlobals(){click=!1,sliderPosition.includes(sliders.current)&&post('position',0),sliders.current=null}function button(a){function c(){switch(b.id){case'minusTop':sliders.current='0';sliderUpdate('positionText',-.1);break;case'plusTop':sliders.current='0';sliderUpdate('positionText',.1);break;case'minusBottom':sliders.current='1';sliderUpdate('incrementText',-.6);break;case'plusBottom':sliders.current='1';sliderUpdate('incrementText',.6);break;case'positionReset':sliders.current='0';sliderUpdate('positionText',1,2.7);break;case'incrementReset':sliders.current='1';sliderUpdate('incrementText',1,40);break}b.id.startsWith('Servo')||(b.style.fill='rgb(0, 0, 255)',setTimeout(a=>{IO=!0,b.style.fill=colors[colors.current]},250)),IO=!1}if(click=!0,a.preventDefault(),idle==1){if(playStop.includes(a.target.id)){togglePlayStop();var d=sliders[sliders.active].slice(0,-1);ajaxPOST(colors.current,d).then(a=>ajaxGET(colors.current)).then(a=>servoSwap(colors.current))}servos.includes(a.target.id)&&(sliders.active=a.target.id.slice(-1),ajaxGET(a.target.id).then(b=>servoSwap(a.target.id)))}if(IO==1){var b;buttons.includes(a.target.parentElement.id)?(b=a.target.parentElement,b.id.endsWith('Text')?b=document.getElementById(b.id.slice(0,-4)):b.id.endsWith('Symbol')&&(b=document.getElementById(b.id.slice(0,-6))),c()):buttons.includes(a.target.id)?(b=a.target,c()):sliderPosition.includes(a.target.id)?sliders.current='0':sliderIncrement.includes(a.target.id)&&(sliders.current='1')}}function togglePlayStop(c){var a;if(c=='Stop')a=1,IO=!0;else if(c=='Play')a=0;else{var d=document.getElementById('Play').style.opacity;a=d==0?1:0,sliders[sliders.active][2]=a}var b=document.getElementById(playStop[a]);b.style.opacity=1,a=Math.abs(a-1);var e=document.getElementById(playStop[a]);e.style.opacity=0;var f=b.parentElement;f.insertBefore(b,null),b.style.fill='rgb(0, 0, 255)',setTimeout(a=>{b.style.fill='rgb(0, 0, 0)'},250)}function sliderUpdate(e,a,f){if(elem=document.getElementById(e).children[0],f)e.includes('position')?(elem.innerHTML=2.7,svgPos[sliders.active][0]=['positionSlider',0,0]):(svgPos[sliders.active][1]=['incrementSlider',0,0],elem.innerHTML=40),loadSVGpos(),sliders[sliders.active][sliders.current]=f;else{var b=parseFloat(elem.innerHTML),c,d;Math.abs(a)==.1?(c=4.5,d=.9):(c=70,d=10),(a<0&&b>d||a>0&&b<c)&&(b+=a,Math.abs(a)==.1?(elem.innerHTML=b.toFixed(1),sliders[sliders.active][0]=b.toFixed(1)):(elem.innerHTML=b.toFixed(0),sliders[sliders.active][1]=b.toFixed(0)),Math.abs(a)==.1?(moveSVG(elem.parentElement.id,Math.sign(a)*4,2),moveSVG(elem.parentElement.previousElementSibling.id,Math.sign(a)*3,1)):(moveSVG(elem.parentElement.id,Math.sign(a)*2.5,2),moveSVG(elem.parentElement.previousElementSibling.id,Math.sign(a)*1.8,1)))}setTimeout(a=>click=!0,10)}function sliderMove(a){if(a.preventDefault(),click&&sliders.current!=null){click=!1,a.type=='touchmove'&&(a.clientX=a.touches[0].clientX),sliderPosition.includes(a.target.id)?a.clientX<b()?sliderUpdate('positionText',-.1):a.clientX>b()&&sliderUpdate('positionText',.1):sliderIncrement.includes(a.target.id)&&(a.clientX<b()?sliderUpdate('incrementText',-.6):a.clientX>b()&&sliderUpdate('incrementText',.6));function b(){var b=a.target.getBoundingClientRect().x,c=a.target.getBoundingClientRect().width,d=b+c/2;return d}}}function servoSwap(a){var d=document.getElementById(a),b=d.style.fill;colors[a]||(colors[a]=b);for(item of colorSwap)document.getElementById(item).style.fill=b;colors.current=a,sliders.active=colors.current.slice(-1);for(var e of servoBars)document.getElementById(e).style.opacity='0.2';var c=document.getElementById('Servo'+sliders.active+'b');c.style.opacity='1',c.style.fill='rgb(0, 0, 255)',setTimeout(a=>{c.style.fill=b},250),document.getElementById(sliderPosition[2]).innerHTML=sliders[sliders.active][0],document.getElementById(sliderIncrement[2]).innerHTML=sliders[sliders.active][1],loadSVGpos()}function ajaxSpit(b){const a=new XMLHttpRequest;a.open('GET','/msg?'+b,!0),a.setRequestHeader('Content-Type','text/plain'),a.send()}function ajaxGET(a){return new Promise((c,d)=>{obj={servo:a},obj=JSON.stringify(obj);const b=new XMLHttpRequest;b.open('POST','/pull',!0),b.setRequestHeader('Content-type','application/json'),b.onreadystatechange=function(){if(b.readyState===4){var e=b.status,a;if(e==200){a=b.responseText,a=JSON.parse(a);const d=a.values;sliders[sliders.active]=[d[0],d[1],d[2]],svgPos[sliders.active][0]=d[3],svgPos[sliders.active][1]=d[4],setTimeout(a=>c(),200)}else e==418&&(a=b.responseText,d())}},b.send(obj)})}function ajaxPOST(a,b){return IO=!1,idle=!1,new Promise((d,e)=>{sliders[sliders.active][2]?obj={servo:a,pos:b[0],duration:b[1],status:sliders[sliders.active][2],posSlider:svgPos[sliders.active][0],incSlider:svgPos[sliders.active][1]}:obj={servo:a,status:sliders[sliders.active][2]},obj=JSON.stringify(obj);const c=new XMLHttpRequest;c.open('POST','/push',!0),c.setRequestHeader('Content-type','application/json'),c.onreadystatechange=function(){if(c.readyState===4){var b=c.status,a;b==200?(a=c.responseText,a=JSON.parse(a),idle=!0,d()):b==418&&(a=c.responseText,e())}},c.send(obj)})}function loadSVG(){return new Promise((b,c)=>{const a=new XMLHttpRequest;a.onload=function(){b(a.responseText)},a.open('GET','SVG'),a.send()})}function moveSVG(h,g,i){var c=document.getElementById(h),d,b,a=c.getAttribute('transform');if(a===null&&(a=''),a.includes('translate')){var e=a.search('translate')+10,f=a.slice(e).split(',');b=parseFloat(f[0])+g,d=a.slice(0,e)+b+','+f[1]}else b=g,d=a.concat('translate('+b+','+0+')');c.setAttribute('transform',d),svgPos[sliders.active][sliders.current][i]=b}function loadSVGpos(){const c=svgPos[sliders.active][0];const d=svgPos[sliders.active][1];var a=0;for(var b of[c,d])elem=document.getElementById(b[0]),resetSVG(elem.id,b[1],0,a),resetSVG(elem.id.slice(0,-6)+'Text',b[2],0,a),a+=1;sliders[sliders.active][2]==0?togglePlayStop('Stop'):togglePlayStop('Play')}function resetSVG(e,c,f,g){var d=document.getElementById(e),b,a=d.getAttribute('transform');if(a===null&&(a=''),a.includes('translate')){var h=a.search('translate');b=a.slice(0,h),b=b.concat('translate('+c+','+f+')'),d.setAttribute('transform',b)}else b=a.concat('translate('+c+','+f+')'),d.setAttribute('transform',b);e.includes('Slider')?svgPos[sliders.active][g][1]=c:svgPos[sliders.active][g][2]=c}function getServos(){return new Promise((b,c)=>{const a=new XMLHttpRequest;a.onload=function(){b(a.responseText)},a.open('GET','servos'),a.send()})}body.style.margin='0px',body.style.backgroundColor='RGB(0,0,0)';var IO=!0,idle=!0,click=!1,sliders={1:[2.7,40,0],2:[2.7,40,0],3:[2.7,40,0],4:[2.7,40,0]};sliders.active='1',sliders.current=null;var svgPos=[];for(var i=1;i<5;i++)svgPos[i]=[],svgPos[i][0]=['positionSlider',0,0],svgPos[i][1]=['incrementSlider',0,0];document.addEventListener('touchstart',button,{passive:!1}),document.addEventListener('touchend',clearGlobals,{passive:!1}),document.addEventListener('touchmove',sliderMove,{passive:!1}),document.addEventListener('mousedown',button),document.addEventListener('mouseup',clearGlobals),document.addEventListener('mousemove',sliderMove),document.addEventListener('selectstart',a=>a.preventDefault()),window.onload=a=>{loadSVG().then(a=>{document.getElementById('svg').innerHTML=a,idArrays(),colors(),document.getElementById('Play').style.opacity=0,document.getElementById('Stop').style.opacity=.6,getServos().then(b=>{b=JSON.parse(b);for(var a=0;a<4;a++){var c=document.getElementById(window.servos[a+4]);c.children[0].textContent=b[a][1],document.getElementById(window.servoText[a]).style.pointerEvents='NONE'}})})}