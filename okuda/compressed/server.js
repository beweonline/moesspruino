function server(){function g(){d=!d,digitalWrite(NodeMCU.D0,d)}function h(d,b){function i(a){a?log('request{method: '+d.method+', url:'+d.url+', data:'+JSON.stringify(a)+'}'):log('request{method: '+d.method+', url:'+d.url+'}')}var g=url.parse(d.url,!0),c='';if(d.method=='POST')d.on('data',function(f){if(f&&(c+=f),c.length>=Number(d.headers['Content-Length'])){if(c=JSON.parse(c),g.pathname=='/pull')c={servo:c.servo,values:a.test(c,'pull')},b.writeHead(200),b.end(JSON.stringify(c));else if(g.pathname=='/push'){a.test(c,'push'),c={servo:c.servo,values:a.test(c,'pull')};var e=0,h=40;function f(a){if(e++,servos[c.servo.slice(-1)-1].idle==1)return a();e<h&&d(a)}function d(a){setTimeout(f,500,a)}var i=new Promise((a,b)=>{d(a)});i.then(a=>{b.writeHead(200),b.end(JSON.stringify(c))})}}else c.length>Number(d.headers['Content-Length'])&&(b.writeHead(418),b.end("alert('data was corrupted')"))});else if(g.method=='GET'){i();function a(c){c=e.read(c);var d=1024,f=Math.ceil(c.length/d),a=1;b.on('drain',function(){a===1?b.write(c.slice(0,d*a)):a>=2&&a<=f&&b.write(c.slice(d*(a-1),d*a)),a++,a>f&&b.end()}),b.write()}if(g.pathname=='/')clearInterval(f),setTimeout(a=>{digitalWrite(NodeMCU.D0,!0)},1e3),b.writeHead(200,{'Content-Type':'text/html'}),a('okuda.html');else if(g.pathname=='/SVG')b.writeHead(200,{'Content-Type':'text/plain; charset=UTF-8'}),a('okuda.svg');else if(g.pathname=='/okuda.js')b.writeHead(200,{'Content-Type':'text/javascript; charset=UTF-8'}),a('okuda.js');else if(g.pathname=='/msg')b.writeHead(200,{'Content-Type':'text/plain'}),b.end('logged');else if(g.pathname=='/servos'){var h=[];for(servo of servos)h.push([servo.device,k(servo.pin.toString())]);b.writeHead(200,{'Content-Type':'text/plain'}),b.end(JSON.stringify(h))}else b.writeHead(404),b.end('404: Not found')}}function i(a){require('http').createServer(h).listen(80),log('Listening on '+a),changeInterval(f,800)}function b(){var a=e.read('id.txt'),b={ip:'192.168.4.'+a,netmask:'255.255.255.0',gw:'192.168.4.'+a};return b}function j(a){a?log(a):(log('access point at',b().ip),i(b().ip),l())}function k(c){var a=['D0','D1','D2','D3','D4','D5','D6','D7','D8','D9','D10'],b=['D16','D5','D4','D0','D2','D14','D12','D13','D15','D3','D1'];return a[b.indexOf(c)]}function l(){var a=require('sg90.js'),b=['D0','D1','D2','D3'];a.setup(b)}const c=require('Wifi');const e=require('Storage');global.log==undefined&&(global.log=function(){});var d=!0,m=NodeMCU.D0,f=setInterval(g,300),a={};a.test=function(b,c){return a[b.servo]||(a[b.servo]={},a[b.servo].pos=2.7,a[b.servo].duration=40,a[b.servo].status=0,a[b.servo].posSlider=['positionSlider',0,0],a[b.servo].incSlider=['incrementSlider',0,0]),c=='push'?a.push(b):c=='pull'?a.pull(b):void 0},a.push=function(b){var c=b.servo.slice(-1)-1;return Object.keys(b).length==2?(a[b.servo].status=b.status,servos[c].sleep()):(a[b.servo].pos=b.pos,a[b.servo].duration=b.duration,servos[c].duration=b.duration,a[b.servo].status=b.status,servos[c].move(Number(b.pos),Number(b.duration)),a[b.servo].posSlider=b.posSlider,a[b.servo].incSlider=b.incSlider),a[b.servo]},a.pull=function(b){var c=b.servo.slice(-1)-1;return b=[a[b.servo].pos=servos[c].position.toFixed(1),a[b.servo].duration=servos[c].duration,a[b.servo].status=servos[c].alive,a[b.servo].posSlider,a[b.servo].incSlider],b},c.disconnect(),c.setAPIP(b(),j),c.startAP('moessARM_'+b().ip,{authMode:'wpa2',password:'12345678'})}var exports={server:a=>server()}